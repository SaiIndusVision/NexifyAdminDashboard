import{D as h,e as s}from"./index-BIpb7VEJ.js";const p=()=>"https://nexify.indusvision.ai/api/",c={PARTNER_ID:"",API_KEY:""},T={AUTH:{LOGIN:"/login/",SIGN_UP:"/user/",SECRET_KEY:"/secret-key/",REGISTER:"/auth/register",REFRESH_TOKEN:"/auth/refresh-token",FORGOT_PASSWORD:"/forgot-password/",RESET_PASSWORD:"/auth/reset-password",VERIFY_EMAIL:"/auth/verify-email",CHANGE_PASSWORD:"/users/reset-password"},NUSERS:{USER:{LIST:"/user/",CREATE:"/user/",STATUS_UPDATE:"/user",UPDATE:"/user/",PRODUCTS:"/user"},WORKSPACE:{LIST:"/workspace/",CREATE:"/workspace/",STATUS_UPDATE:"/workspace",UPDATE:"/workspace/",GET_BY_ID:e=>`/workspace/${e}`}}};function R(e){return e.split(".").reduce((r,t)=>r[t],T)}const a=h.create({baseURL:"/api",headers:{"Content-Type":"application/json"},withCredentials:!0});let i=!1,u=[];const E=(e,r)=>{u.forEach(t=>{r?t.resolve(r):t.reject(e)}),u=[]};a.interceptors.request.use(e=>{const r=s.getState().auth.access_token;return r&&e.headers&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));a.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response?.status===401&&!r._retry){if(i)return new Promise((t,o)=>{u.push({resolve:t,reject:o})}).then(t=>(r.headers&&(r.headers.Authorization=`Bearer ${t}`),a(r))).catch(t=>Promise.reject(t));r._retry=!0,i=!0;try{const t=s.getState().auth.refresh_token;if(!t)throw new Error("No refresh token available");const o=`${p()}/refresh/accessToken`,S=await h.get(o,{params:{refreshToken:t},headers:{"x-partner-id":c.PARTNER_ID,"x-api-key":c.API_KEY}}),{accessToken:n}=S.data.data;return s.getState().updateAccessToken(n),E(null,n),r.headers&&(r.headers.Authorization=`Bearer ${n}`),a(r)}catch(t){return E(t,null),s.getState().logout(),Promise.reject(t)}finally{i=!1}}return Promise.reject(e)});export{a,R as g};
