import{C as q,a as L,r as n,D as J,j as e,B as K,t as p}from"./index-BIpb7VEJ.js";import{u as I,A as O,b as T}from"./alert-D0l1lUrz.js";import{a as M}from"./axiosInstance-SHYzUQLh.js";import{S as A,M as V}from"./Modal-CMAZ7A_o.js";import{P as H}from"./phoneinput-BV71Ua43.js";import{S as G,a as Q,b as R,c as X,d as W}from"./select-pvPekMj3.js";import{H as Y,T as Z,P as ee,M as se}from"./theme-switch-BM4-891m.js";import{c as ae}from"./workspace-columns-DndduzNd.js";import{W as te}from"./workspace-table-YnT_YtZx.js";import{U as re,a as ne}from"./users-dialogs-CyBLa8IA.js";import{C as oe}from"./chevron-left-Dk9p464F.js";import{S as ie}from"./square-pen-B1t4vBZH.js";import{X as le}from"./dialog-BB3aeqbb.js";import{C as ce}from"./check-Dy8uVGp8.js";import"./input-rNDUznzA.js";import"./index-BdQq_4o_.js";import"./index-DdYp0NZ-.js";import"./index-HAQUmL7d.js";import"./index-BPgIyX4J.js";import"./index-XUdhzyfV.js";import"./index-DhVeR81R.js";import"./index-5gSC79ij.js";import"./index-vvVGFqZL.js";import"./chevron-down-SDtBDa1w.js";import"./createLucideIcon-BFWoEbaP.js";import"./sidebar-hxPOteIt.js";import"./index-CGqW8isM.js";import"./dropdown-menu-CPcBh0xs.js";import"./index-gCXyVcA9.js";import"./chevron-right-BFa11Oe8.js";import"./react-icons.esm-D3ovVlUy.js";import"./table-BuU_D776.js";import"./confirm-dialog-CJxajWTN.js";import"./form-BL-c6AUK.js";import"./show-submitted-data-orVsdGJT.js";import"./IconMailPlus-BDMz9cXb.js";import"./createReactComponent-q0sjk0bg.js";import"./textarea-Dp9AB515.js";import"./IconSend-B_OWqEoY.js";const de=async t=>(await M.get(`/user/${t}/`))?.data,ue=async t=>(await M.get(`/workspace/?created_by=${t}&page_size=300/`))?.data;function me(){const{userId:t}=q({from:"/_authenticated/users/$userId"}),m=L(),{data:v,isLoading:y,error:w,refetch:c}=I({queryKey:["user",t],queryFn:()=>de(t)}),[h,a]=n.useState(1),[d,_]=n.useState(300),[N,S]=n.useState([]),[u,x]=n.useState(""),[C,f]=n.useState(!1),[b,k]=n.useState(!1),[P,U]=n.useState(null),[z,l]=n.useState([]);n.useEffect(()=>{J.get("https://nexify.indusvision.ai/api/user/?role=3").then(i=>S(i.data.results)).catch(i=>console.error("Failed to fetch field assistants",i))},[]);const{data:g,isLoading:s,error:r,refetch:o}=I({queryKey:["workspaces",t],queryFn:()=>ue(t)});if(y)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(A,{className:"h-10 w-24"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:6}).map((i,j)=>e.jsx(A,{className:"h-6 w-full"},j))})]})]});if(w)return e.jsx("div",{className:"p-4",children:e.jsx(O,{variant:"destructive",children:e.jsx(T,{children:"Failed to load user details. Please try again."})})});if(!v)return e.jsx("div",{className:"p-4",children:e.jsx(O,{children:e.jsx(T,{children:"User not found"})})});const E=async i=>{try{if(!(await fetch(`https://nexify.indusvision.ai/api/user/${t}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Update failed");p.success("User profile updated successfully.",{position:"top-center"}),await c(),await o()}catch{p.error("Failed to update user info.")}},$=async i=>{f(!0);try{const F=await(await fetch("https://nexify.indusvision.ai/api/workspace-activate/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workspace_id:i,field_assistant:Number(u)})})).json();console.log(F),p.success(`${F.message}`,{position:"top-center"})}catch{p.error("Activation key generation failed",{position:"top-center"})}finally{f(!1)}},D=Math.ceil(7/d),B=()=>{m("/users")};return e.jsxs(re,{children:[e.jsx(Y,{fixed:!0,children:e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Z,{}),e.jsx(ee,{})]})}),e.jsxs(se,{children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsx(pe,{user:v,onSave:E,onNavigateBack:B,onUserUpdate:c})}),e.jsx("div",{className:"max-h-110 overflow-scroll rounded-md bg-white/50 p-2 dark:bg-white/20",children:e.jsx(te,{data:g?.results||[],columns:ae({fieldAssistants:N,handleGenerateKey:$,fieldAssistantId:u,setFieldAssistantId:x,loading:C,setWorkspaceData:l,workspaceData:z,isModalOpen:b,setModalOpen:k,selectedWorkspaceId:P,setSelectedWorkspaceId:U}),pageCount:D,pageIndex:h-1,pageSize:d,onPageChange:i=>a(i+1),onPageSizeChange:_})})]}),e.jsx(ne,{})]})}const pe=({user:t,onSave:m,onNavigateBack:v,onUserUpdate:y})=>{const w=L(),[c,h]=n.useState(!1),[a,d]=n.useState({}),[_,N]=n.useState({}),[S,u]=n.useState(!1),[x,C]=n.useState(null),f=["id","first_name","last_name","email","country_code","phone_number"];n.useEffect(()=>{t?.results&&(d(t.results),N(t.results))},[t?.results]);const b=(s,r)=>{d(o=>({...o,[s]:r}))},k=(s,r)=>{d(o=>({...o,phone_number:s,country_code:r}))},P=async()=>{try{const s={};f.forEach(r=>{s[r]=a[r]}),s.phone_number&&(s.phone_number=Number(s.phone_number)),m&&await m(s),h(!1),N(a)}catch(s){console.error("Failed to save user profile:",s)}},U=()=>{d(_),h(!1)},z=async(s,r)=>{try{const o=await fetch(`https://nexify.indusvision.ai/api/user/${s}/`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({is_authorized:r})});if(!o.ok)throw new Error("Failed to update user status");const E=await o.json();p.success(E?.message||"User status updated successfully",{position:"top-center"}),y&&await y()}catch{p.error("Something went wrong while updating user status.",{position:"top-center"})}},l=s=>{switch(s){case"first_name":return"First Name";case"last_name":return"Last Name";case"email":return"Email";case"country_code":return"Country Code";case"phone_number":return"Contact number";case"verification_status":return"Verification Status";case"onboarding_date":return"Onboarding Date & Time";default:return s.replace(/_/g," ")}},g=(s,r)=>c&&f.includes(s)?s==="country_code"?e.jsx("div",{className:"text-foreground flex items-center gap-2",children:e.jsxs("select",{value:r||"+91",onChange:o=>b(s,o.target.value),className:"flex-1 rounded border border-gray-300 px-2 py-1 text-sm",children:[e.jsx("option",{value:"+91",children:"+91"}),e.jsx("option",{value:"+1",children:"+1"}),e.jsx("option",{value:"+44",children:"+44"})]})}):e.jsx("input",{type:s==="email"?"email":"text",value:r||"",onChange:o=>b(s,o.target.value),className:"text-foreground w-full rounded border border-gray-300 px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"}):s==="country_code"&&!c?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:r})}):e.jsx("span",{className:"text-sm text-gray-900",children:r||"â€”"});return t?.results?e.jsxs("div",{className:"text-foreground rounded-lg border bg-white/50 shadow-sm dark:bg-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"text-foreground flex items-center gap-3",children:[e.jsx(K,{variant:"ghost",onClick:()=>w({to:"/users"}),className:"flex items-center gap-2",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-foreground text-xl font-semibold",children:[a.first_name," ",a.last_name]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(G,{value:a?.is_authorized===null?"pending":a?.is_authorized?"authorized":"unauthorized",onValueChange:s=>{C(s==="authorized"?!0:s==="unauthorized"?!1:null),u(!0)},children:[e.jsx(Q,{className:`w-[150px] rounded-full border px-4 py-1 text-white ${a?.is_authorized==!0?"bg-green-500":a?.is_authorized==!1?"bg-red-500":"bg-orange-500"}`,children:e.jsx(R,{placeholder:"Select Status"})}),e.jsxs(X,{children:[e.jsx(W,{value:"authorized",children:"Authorized"}),e.jsx(W,{value:"unauthorized",children:"Unauthorized"})]})]})})]}),e.jsxs(V,{isOpen:S,onClose:()=>u(!1),title:"Confirm Status Change",children:[e.jsxs("div",{children:["Are you sure you want to"," ",e.jsx("strong",{children:x===!0?"authorize":x===!1?"revoke access":"set as pending"})," ","this user?"]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"rounded-full bg-[#B92424] px-5 py-1 text-white hover:bg-red-500",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{await z(a?.id,x),u(!1)},className:"rounded-full bg-[#43996A] px-5 py-1 text-white hover:bg-green-600",children:"Confirm"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:c?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,className:"text-foreground flex items-center gap-2 rounded-lg border border-gray-300 p-1 transition-colors hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsx(le,{className:"h-4 w-4"}),"Cancel"]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 rounded-lg bg-blue-600 p-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(ce,{className:"h-4 w-4"}),"Save Changes"]})]}):e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 rounded-lg bg-blue-600 p-1 text-white transition-colors hover:bg-blue-700",children:[e.jsx(ie,{className:"h-4 w-4"}),"Edit Profile"]})})]}),e.jsx("div",{className:"text-foreground p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-8 gap-y-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("first_name")}),e.jsx("span",{className:"text-foreground",children:g("first_name",a.first_name)})]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("last_name")}),g("last_name",a.last_name)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex w-full gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("phone_number")}),c?e.jsx(H,{value:`${a.country_code||""}${a.phone_number||""}`,onChange:k}):e.jsxs("span",{className:"text-sm text-gray-900",children:[a.country_code," ",a.phone_number]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("email")}),g("email",a.email)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("verification_status")}),e.jsx("span",{className:"text-sm text-gray-900",children:a.verification_status})]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("onboarding_date")}),e.jsx("span",{className:"text-sm text-gray-900",children:a.onboarding_date})]})})]})]})})]}):e.jsx("div",{className:"p-4",children:"Loading..."})},Ze=me;export{Ze as component};
