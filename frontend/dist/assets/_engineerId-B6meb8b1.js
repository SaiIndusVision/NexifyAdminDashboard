import{C as q,a as W,r,D as J,j as e,B as K,t as h}from"./index-BIpb7VEJ.js";import{u as F,A as I,b as O}from"./alert-D0l1lUrz.js";import{a as L}from"./axiosInstance-SHYzUQLh.js";import{S as E,M as V}from"./Modal-CMAZ7A_o.js";import{S as H,a as G,b as Q,c as R,d as T}from"./select-pvPekMj3.js";import{H as X,T as Y,P as Z,M as ee}from"./theme-switch-BM4-891m.js";import{c as se}from"./workspace-columns-DndduzNd.js";import{W as ae}from"./workspace-table-YnT_YtZx.js";import{U as te,a as re}from"./users-dialogs-DjeFqa1X.js";import{C as ne}from"./chevron-left-Dk9p464F.js";import{S as ie}from"./square-pen-B1t4vBZH.js";import{X as oe}from"./dialog-BB3aeqbb.js";import{C as le}from"./check-Dy8uVGp8.js";import"./index-BdQq_4o_.js";import"./index-DdYp0NZ-.js";import"./index-HAQUmL7d.js";import"./index-BPgIyX4J.js";import"./index-XUdhzyfV.js";import"./index-DhVeR81R.js";import"./index-5gSC79ij.js";import"./index-vvVGFqZL.js";import"./chevron-down-SDtBDa1w.js";import"./createLucideIcon-BFWoEbaP.js";import"./sidebar-hxPOteIt.js";import"./index-CGqW8isM.js";import"./dropdown-menu-CPcBh0xs.js";import"./index-gCXyVcA9.js";import"./chevron-right-BFa11Oe8.js";import"./react-icons.esm-D3ovVlUy.js";import"./table-BuU_D776.js";import"./input-rNDUznzA.js";import"./confirm-dialog-CJxajWTN.js";import"./form-BL-c6AUK.js";import"./phoneinput-BV71Ua43.js";import"./show-submitted-data-orVsdGJT.js";import"./IconMailPlus-BDMz9cXb.js";import"./createReactComponent-q0sjk0bg.js";import"./textarea-Dp9AB515.js";import"./IconSend-B_OWqEoY.js";const ce=async t=>(await L.get(`/user/${t}/`))?.data,de=async t=>(await L.get(`/workspace/?created_by=${t}&page_size=300/`))?.data;function me(){const{engineerId:t}=q({from:"/_authenticated/engineers/$engineerId"}),d=W(),{data:v,isLoading:N,error:w,refetch:m}=F({queryKey:["user",t],queryFn:()=>ce(t)}),[x,a]=r.useState(1),[u,S]=r.useState(300),[b,y]=r.useState([]),[g,_]=r.useState(""),[k,l]=r.useState(!1),[c,C]=r.useState(!1),[p,f]=r.useState(null),[z,U]=r.useState([]);r.useEffect(()=>{J.get("http://localhost:8001/api/user/?role=3").then(o=>y(o.data.results)).catch(o=>console.error("Failed to fetch field assistants",o))},[]);const{data:s,isLoading:n,error:i,refetch:P}=F({queryKey:["workspaces",t],queryFn:()=>de(t)});if(N)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(E,{className:"h-10 w-24"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:6}).map((o,j)=>e.jsx(E,{className:"h-6 w-full"},j))})]})]});if(w)return e.jsx("div",{className:"p-4",children:e.jsx(I,{variant:"destructive",children:e.jsx(O,{children:"Failed to load user details. Please try again."})})});if(!v)return e.jsx("div",{className:"p-4",children:e.jsx(I,{children:e.jsx(O,{children:"User not found"})})});const M=async o=>{try{if(!(await fetch(`http://localhost:8001/api/user/${t}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Update failed");h.success("User profile updated successfully.",{position:"top-center"}),await m(),await P()}catch{h.error("Failed to update user info.")}},D=async o=>{l(!0);try{const A=await(await fetch("http://localhost:8001/api/workspace-activate/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workspace_id:o,field_assistant:Number(g)})})).json();console.log(A),h.success(`${A.message}`,{position:"top-center"})}catch{h.error("Activation key generation failed",{position:"top-center"})}finally{l(!1)}},$=Math.ceil(7/u),B=()=>{d("/engineers")};return e.jsxs(te,{children:[e.jsx(X,{fixed:!0,children:e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Y,{}),e.jsx(Z,{})]})}),e.jsxs(ee,{children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsx(ue,{user:v,onSave:M,onNavigateBack:B,onUserUpdate:m})}),e.jsx("div",{className:"max-h-110 overflow-scroll rounded-md bg-white/50 p-2 dark:bg-white/20",children:e.jsx(ae,{data:s?.results||[],columns:se({fieldAssistants:b,handleGenerateKey:D,fieldAssistantId:g,setFieldAssistantId:_,loading:k,setWorkspaceData:U,workspaceData:z,isModalOpen:c,setModalOpen:C,selectedWorkspaceId:p,setSelectedWorkspaceId:f}),pageCount:$,pageIndex:x-1,pageSize:u,onPageChange:o=>a(o+1),onPageSizeChange:S})})]}),e.jsx(re,{})]})}const ue=({user:t,onSave:d,onNavigateBack:v,onUserUpdate:N})=>{const w=W(),[m,x]=r.useState(!1),[a,u]=r.useState({}),[S,b]=r.useState({}),y=["id","first_name","last_name","email","country_code","phone_number"],g=(s,n)=>{u(i=>({...i,[s]:n}))},_=async()=>{try{const s={};y.forEach(n=>{s[n]=a[n]}),s.phone_number&&(s.phone_number=Number(s.phone_number)),d&&await d(s),x(!1),b(a)}catch(s){console.error("Failed to save user profile:",s)}},k=()=>{u(S),x(!1)},l=s=>{switch(s){case"first_name":return"First Name";case"last_name":return"Last Name";case"email":return"Email";case"country_code":return"Country Code";case"phone_number":return"Contact number";case"verification_status":return"Verification Status";case"onboarding_date":return"Onboarding Date & Time";default:return s.replace(/_/g," ")}},c=(s,n)=>m&&y.includes(s)?s==="country_code"?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:n,onChange:i=>g(s,i.target.value),className:"flex-1 rounded border border-gray-300 px-2 py-1 text-sm",children:[e.jsx("option",{value:"+91",children:"+91"}),e.jsx("option",{value:"+1",children:"+1"}),e.jsx("option",{value:"+44",children:"+44"})]})}):e.jsx("input",{type:s==="email"?"email":"text",value:n||"",onChange:i=>g(s,i.target.value),className:"w-full rounded border border-gray-300 px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"}):s==="country_code"&&!m?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:n})}):e.jsx("span",{className:"text-sm text-gray-900",children:n||"â€”"});if(!t?.results)return e.jsx("div",{className:"p-4",children:"Loading..."});const[C,p]=r.useState(!1),[f,z]=r.useState(null),U=async(s,n)=>{try{const i=await fetch(`http://localhost:8001/api/user/${t?.results?.id}/`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({is_authorized:n})});if(!i.ok)throw new Error("Failed to update user status");const P=await i.json();h.success(P?.message,{position:"top-center"}),N&&await N()}catch{h.error("Something went wrong while updating user status.",{position:"top-center"})}};return r.useEffect(()=>{t?.results&&(u(t?.results),b(t?.results))},[t?.results]),e.jsxs("div",{className:"text-foreground rounded-lg border bg-white/50 shadow-sm dark:bg-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"text-foreground flex items-center gap-3",children:[e.jsx(K,{variant:"ghost",onClick:()=>w({to:"/engineers"}),className:"text-foreground flex items-center gap-2",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-foreground text-xl font-semibold",children:[a.first_name," ",a.last_name]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(H,{value:a?.is_authorized===null?"pending":a?.is_authorized?"authorized":"unauthorized",onValueChange:s=>{z(s==="authorized"?!0:s==="unauthorized"?!1:null),p(!0)},children:[e.jsx(G,{className:`w-[150px] rounded-full border px-4 py-1 text-white ${a?.is_authorized==!0?"bg-green-500":a?.is_authorized==!1?"bg-red-500":"bg-orange-500"} `,children:e.jsx(Q,{placeholder:"Select Status"})}),e.jsxs(R,{children:[e.jsx(T,{value:"authorized",children:"Authorized"}),e.jsx(T,{value:"unauthorized",children:"Unauthorized"})]})]})})]}),e.jsxs(V,{isOpen:C,onClose:()=>p(!1),title:"Confirm Status Change",children:[e.jsxs("div",{children:["Are you sure you want to"," ",e.jsx("strong",{children:f===!0?"authorize":f===!1?"revoke access":"set as pending"})," ","this user?"]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1)},className:"rounded-full bg-[#B92424] px-5 py-1 text-white hover:bg-red-500",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{await U(a?.id,f),p(!1)},className:"rounded-full bg-[#43996A] px-5 py-1 text-white hover:bg-green-600",children:"Confirm"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:m?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:k,className:"flex items-center gap-2 rounded-lg border border-gray-300 p-2 text-gray-700 transition-colors hover:bg-gray-50",children:[e.jsx(oe,{className:"h-4 w-4"}),"Cancel"]}),e.jsxs("button",{onClick:_,className:"flex items-center gap-2 rounded-lg bg-blue-600 p-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(le,{className:"h-4 w-4"}),"Save Changes"]})]}):e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 rounded-lg bg-blue-600 p-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(ie,{className:"h-4 w-4"}),"Edit Profile"]})})]}),e.jsx("div",{className:"text-foreground p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-8 gap-y-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("first_name")}),c("first_name",a.first_name)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[" ",e.jsx("span",{className:"w-60",children:l("last_name")}),c("last_name",a.last_name)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("phone_number")}),c("country_code",a.country_code),c("phone_number",a.phone_number)]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("email")}),c("email",a.email)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("verification_status")}),e.jsx("span",{className:"text-sm text-gray-900",children:a.verification_status})]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:l("onboarding_date")}),e.jsx("span",{className:"text-sm text-gray-900",children:a.onboarding_date})]})})]})]})})]})},Ye=me;export{Ye as component};
