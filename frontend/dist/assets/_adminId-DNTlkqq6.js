import{C as D,a as A,r as t,D as T,j as e,B as W,t as x}from"./index-BIpb7VEJ.js";import{u as U,A as E,b as F}from"./alert-D0l1lUrz.js";import{a as I}from"./axiosInstance-SHYzUQLh.js";import{S as w,M as B}from"./Modal-CMAZ7A_o.js";import{H as $,T as q,P as H,M as J}from"./theme-switch-BM4-891m.js";import{U as K,a as V}from"./users-dialogs-BAUqXZF_.js";import{C as Q}from"./chevron-left-Dk9p464F.js";import"./sidebar-hxPOteIt.js";import"./dialog-BB3aeqbb.js";import"./index-DdYp0NZ-.js";import"./index-DhVeR81R.js";import"./index-BPgIyX4J.js";import"./index-XUdhzyfV.js";import"./index-CGqW8isM.js";import"./createLucideIcon-BFWoEbaP.js";import"./index-vvVGFqZL.js";import"./dropdown-menu-CPcBh0xs.js";import"./index-HAQUmL7d.js";import"./index-gCXyVcA9.js";import"./chevron-right-BFa11Oe8.js";import"./check-Dy8uVGp8.js";import"./confirm-dialog-CJxajWTN.js";import"./form-BL-c6AUK.js";import"./input-rNDUznzA.js";import"./phoneinput-BV71Ua43.js";import"./show-submitted-data-orVsdGJT.js";import"./IconMailPlus-BDMz9cXb.js";import"./createReactComponent-q0sjk0bg.js";import"./textarea-Dp9AB515.js";import"./IconSend-B_OWqEoY.js";const b=async s=>(await I.get(`/user/${s}/`))?.data,P=async s=>(await I.get(`/workspace/?created_by=${s}&page_size=300/`))?.data;function R(){const{adminId:s}=D({from:"/_authenticated/admin/$adminId"}),d=A(),{data:h,isLoading:f,error:m}=U({queryKey:["admin",s],queryFn:()=>b(s),refetchOnMount:!0}),[O,a]=t.useState(300),[g,j]=t.useState([]),[_,S]=t.useState(""),[y,c]=t.useState(!1),[l,k]=t.useState(1),[p,u]=t.useState(!1),[z,N]=t.useState(null),[r,o]=t.useState([]);t.useEffect(()=>{T.get("https://nexify.indusvision.ai/api/user/?role=3").then(n=>j(n.data.results)).catch(n=>console.error("Failed to fetch field assistants",n))},[]),t.useEffect(()=>{fetch("https://nexify.indusvision.ai/api/user/?role=3").then(n=>n.json()).then(n=>j(n.results)).catch(n=>console.error("Failed to fetch users",n))},[]);const{data:i,isLoading:C,error:X}=U({queryKey:["workspaces",s],queryFn:()=>P(s)});if(f)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(w,{className:"h-10 w-24"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:6}).map((n,v)=>e.jsx(w,{className:"h-6 w-full"},v))})]})]});if(m)return e.jsx("div",{className:"p-4",children:e.jsx(E,{variant:"destructive",children:e.jsx(F,{children:"Failed to load user details. Please try again."})})});if(!h)return e.jsx("div",{className:"p-4",children:e.jsx(E,{children:e.jsx(F,{children:"User not found"})})});const L=async n=>{try{if(!(await fetch(`https://nexify.indusvision.ai/api/user/${s}/`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Update failed");x.success("User profile updated successfully.",{position:"top-center"}),b(s),P(s)}catch{x.error("Failed to update user info.")}},M=()=>{d("/admin")};return e.jsxs(K,{children:[e.jsx($,{fixed:!0,children:e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(q,{}),e.jsx(H,{})]})}),e.jsx(J,{children:e.jsx("div",{className:"space-y-2 pb-4",children:e.jsx(G,{user:h,onSave:L,onNavigateBack:M})})}),e.jsx(V,{})]})}const G=({user:s,onSave:d,onNavigateBack:h})=>{const f=A(),[m,O]=t.useState(!1),[a,g]=t.useState({}),[j,_]=t.useState({}),S=["id","first_name","last_name","email","country_code","phone_number"],y=(r,o)=>{g(i=>({...i,[r]:o}))},c=r=>{switch(r){case"first_name":return"First Name";case"last_name":return"Last Name";case"email":return"Email";case"country_code":return"Country Code";case"phone_number":return"Contact number";case"verification_status":return"Verification Status";case"onboarding_date":return"Onboarding Date & Time";default:return r.replace(/_/g," ")}},l=(r,o)=>m&&S.includes(r)?r==="country_code"?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:o,onChange:i=>y(r,i.target.value),className:"flex-1 rounded border border-gray-300 px-2 py-1 text-sm",children:[e.jsx("option",{value:"+91",children:"+91"}),e.jsx("option",{value:"+1",children:"+1"}),e.jsx("option",{value:"+44",children:"+44"})]})}):e.jsx("input",{type:r==="email"?"email":"text",value:o||"",onChange:i=>y(r,i.target.value),className:"w-full rounded border border-gray-300 px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"}):r==="country_code"&&!m?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:o})}):e.jsx("span",{className:"text-sm text-gray-900",children:o||"â€”"});if(!s?.results)return e.jsx("div",{className:"p-4",children:"Loading..."});const[k,p]=t.useState(!1),[u,z]=t.useState(null),N=async(r,o)=>{try{const i=await fetch(`https://nexify.indusvision.ai/api/user/${s?.results?.id}/`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({is_authorized:o})});if(!i.ok)throw new Error("Failed to update user status");const C=await i.json();x.success(C?.message,{position:"top-center"}),window.location.reload(),b(s?.results?.id)}catch{x.error("Something went wrong while updating user status.",{position:"top-center"})}};return t.useEffect(()=>{s?.results&&(g(s?.results),_(s?.results))},[s,N]),e.jsxs("div",{className:"text-foreground rounded-lg border bg-white/50 shadow-sm dark:bg-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"text-foreground flex items-center gap-3",children:[e.jsx(W,{variant:"ghost",onClick:()=>f({to:"/admin"}),className:"flex items-center gap-2",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-foreground text-xl font-semibold text-gray-900",children:[a.first_name," ",a.last_name]})]}),e.jsxs(B,{isOpen:k,onClose:()=>p(!1),title:"Confirm Status Change",children:[e.jsxs("div",{children:["Are you sure you want to"," ",e.jsx("strong",{children:u===!0?"authorize":u===!1?"revoke access":"set as pending"})," ","this user?"]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{p(!1),setSelectedValue(a?.is_authorized==null?"pending":a?.is_authorized?"authorized":"unauthorized")},className:"rounded-full bg-[#B92424] px-5 py-1 text-white hover:bg-red-500",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{await N(a?.id,u),p(!1)},className:"rounded-full bg-[#43996A] px-5 py-1 text-white hover:bg-green-600",children:"Confirm"})]})]})]}),e.jsx("div",{className:"text-foreground p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-8 gap-y-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"text-foreground flex gap-4 text-sm font-medium",children:[e.jsx("span",{className:"w-60",children:c("first_name")}),l("first_name",a.first_name)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"flex gap-4 text-sm font-medium text-gray-600",children:[" ",e.jsx("span",{className:"w-60",children:c("last_name")}),l("last_name",a.last_name)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"flex gap-4 text-sm font-medium text-gray-600",children:[e.jsx("span",{className:"w-60",children:c("phone_number")}),l("country_code",a.country_code),l("phone_number",a.phone_number)]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"flex gap-4 text-sm font-medium text-gray-600",children:[e.jsx("span",{className:"w-60",children:c("email")}),l("email",a.email)]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"flex gap-4 text-sm font-medium text-gray-600",children:[e.jsx("span",{className:"w-60",children:c("verification_status")}),e.jsx("span",{className:"text-sm text-gray-900",children:a.verification_status})]})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs("label",{className:"flex gap-4 text-sm font-medium text-gray-600",children:[e.jsx("span",{className:"w-60",children:c("onboarding_date")}),e.jsx("span",{className:"text-sm text-gray-900",children:a.onboarding_date})]})})]})]})})]})},Ue=R;export{Ue as component};
