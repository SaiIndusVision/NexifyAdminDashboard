import{r as d,j as e,R as E,o as S,B as y,d as B,s as m,t as M,v as z}from"./index-BIpb7VEJ.js";import{u as J,C as H}from"./confirm-dialog-CJxajWTN.js";import{u as I,a as P,F,b as u,c as h,d as p,e as x,f as j,L as W}from"./form-BL-c6AUK.js";import{D as T,a as U,b as A,c as k,d as O,e as _,f as G}from"./dialog-BB3aeqbb.js";import{I as N}from"./input-rNDUznzA.js";import{P as K}from"./phoneinput-BV71Ua43.js";import{s as V}from"./show-submitted-data-orVsdGJT.js";import{A as Q,a as X,b as Y}from"./alert-D0l1lUrz.js";import{I as Z,a as R}from"./IconMailPlus-BDMz9cXb.js";import{T as ee}from"./textarea-Dp9AB515.js";import{I as se}from"./IconSend-B_OWqEoY.js";const $=E.createContext(null);function Ne({children:s}){const[i,r]=J(null),[o,t]=d.useState(null);return e.jsx($,{value:{open:i,setOpen:r,currentRow:o,setCurrentRow:t},children:s})}const re=()=>{const s=E.useContext($);if(!s)throw new Error("useUsers has to be used within <UsersContext>");return s},ae=S({firstName:m().min(1,"First Name is required."),lastName:m().min(1,"Last Name is required."),countryCode:m().min(1,"Country code is required."),phoneNumber:m().refine(s=>s.length>0,{message:"Phone number is required."}),email:m().email({message:"Email is required."}),password:m().optional(),confirmPassword:m().optional(),isEdit:B().optional().default(!1)});function D({currentRow:s,open:i,onOpenChange:r}){const o=!!s,[t,c]=d.useState({countryCode:"+91",phoneNumber:""}),[g,v]=d.useState(!1),[w,C]=d.useState(""),n=I({resolver:P(ae),defaultValues:{firstName:"",lastName:"",email:"",phoneNumber:"",password:"",confirmPassword:"",countryCode:"+91",isEdit:!1},mode:"onSubmit",reValidateMode:"onBlur"});d.useEffect(()=>{o&&s?(n.reset({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phoneNumber:s.phoneNumber||"",countryCode:s.countryCode||"+91",password:"",confirmPassword:"",isEdit:!0}),c({countryCode:s.countryCode||"+91",phoneNumber:s.phoneNumber||""})):(n.reset({firstName:"",lastName:"",email:"",phoneNumber:"",password:"",confirmPassword:"",countryCode:"+91",isEdit:!1}),c({countryCode:"+91",phoneNumber:""}))},[s,o,n]);const q=(a,f)=>{c({countryCode:f,phoneNumber:a}),n.setValue("phoneNumber",a),n.setValue("countryCode",f)},L=async a=>{v(!0),C("");const f={email:a.email,first_name:a.firstName,last_name:a.lastName,phone_number:parseInt(t.phoneNumber),country_code:t.countryCode,role_id:2,is_active:!0,started_on:new Date().toISOString().slice(0,10),...a.password&&{password:a.password}};console.log("Payload to be sent:",f);try{const l=await fetch("https://nexify.indusvision.ai/api/user/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(l.ok){const b=await l.json();console.log("Success response:",b),M.success("Engineer created successfully!"),n.reset(),c({countryCode:"+91",phoneNumber:""}),r(!1),setTimeout(()=>{window.location.reload()},[2e3])}else{const b=await l.json().catch(()=>({message:l.statusText}));console.error("API Error:",b),C(b.message||`Failed to submit: ${l.statusText}`)}}catch(l){console.error("Network Error:",l),C(l instanceof Error?l.message:"Network error occurred")}finally{v(!1)}};return e.jsx(T,{open:i,onOpenChange:a=>{a||(n.reset(),c({countryCode:"+91",phoneNumber:""})),r(a)},children:e.jsxs(U,{className:"sm:max-w-xl",children:[e.jsxs(A,{className:"text-left",children:[e.jsx(k,{children:o?"Edit Engineer":"Add New Engineer"}),e.jsx(O,{children:"Fill all the details."}),w&&e.jsxs("div",{className:"mt-2 rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("div",{className:"font-medium",children:"Error:"}),e.jsx("div",{children:w})]})]}),e.jsx("div",{className:"w-full overflow-y-auto py-1 pr-4",children:e.jsx(F,{...n,children:e.jsxs("form",{id:"user-form",onSubmit:n.handleSubmit(L),className:"space-y-4 p-0.5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{control:n.control,name:"firstName",render:({field:a})=>e.jsxs(h,{className:"grid grid-cols-2 items-center space-y-0",children:[e.jsxs(p,{className:"col-span-2 text-right",children:["First Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{children:e.jsx(N,{placeholder:"John",className:"col-span-4",autoComplete:"off",...a})}),e.jsx(j,{className:"col-span-2"})]})}),e.jsx(u,{control:n.control,name:"lastName",render:({field:a})=>e.jsxs(h,{className:"grid grid-cols-2 items-center gap-2 space-y-0",children:[e.jsxs(p,{className:"col-span-2 text-right",children:["Last Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{children:e.jsx(N,{placeholder:"Doe",className:"col-span-4",autoComplete:"off",...a})}),e.jsx(j,{className:"col-span-2"})]})})]}),e.jsx(u,{control:n.control,name:"email",render:({field:a})=>e.jsxs(h,{className:"grid grid-cols-2 items-center gap-2 space-y-0",children:[e.jsxs(p,{className:"col-span-2 text-right",children:["Email Address",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{children:e.jsx(N,{placeholder:"john.doe@gmail.com",className:"col-span-4",...a})}),e.jsx(j,{className:"col-span-2"})]})}),e.jsx(u,{control:n.control,name:"phoneNumber",render:({field:a})=>e.jsxs(h,{className:"grid grid-cols-2 items-center gap-2 space-y-0",children:[e.jsxs(p,{className:"col-span-2 text-right",children:["Phone Number",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{children:e.jsx("div",{className:"col-span-4",children:e.jsx(K,{value:`${t.countryCode}${t.phoneNumber}`,onChange:q,hasError:!!n.formState.errors.phoneNumber})})}),e.jsx(j,{className:"col-span-2"})]})})]})})}),e.jsxs(_,{children:[e.jsx(y,{onClick:()=>{n.reset(),c({countryCode:"+91",phoneNumber:""}),r(!1)},type:"button",className:"bg-red-600 text-white hover:bg-red-500",children:"Cancel"}),e.jsx(y,{type:"submit",form:"user-form",disabled:g,className:"min-w-[120px]",children:g?"Creating...":o?"Update Engineer":"Create New Engineer"})]})]})})}function te({open:s,onOpenChange:i,currentRow:r}){const[o,t]=d.useState(""),c=()=>{o.trim()===r.username&&(i(!1),V(r,"The following user has been deleted:"))};return e.jsx(H,{open:s,onOpenChange:i,handleConfirm:c,disabled:o.trim()!==r.username,title:e.jsxs("span",{className:"text-destructive",children:[e.jsx(Z,{className:"stroke-destructive mr-1 inline-block",size:18})," ","Delete User"]}),desc:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"mb-2",children:["Are you sure you want to delete"," ",e.jsx("span",{className:"font-bold",children:r.username}),"?",e.jsx("br",{}),"This action will permanently remove the user with the role of"," ",e.jsx("span",{className:"font-bold",children:r.role.toUpperCase()})," ","from the system. This cannot be undone."]}),e.jsxs(W,{className:"my-2",children:["Username:",e.jsx(N,{value:o,onChange:g=>t(g.target.value),placeholder:"Enter username to confirm deletion."})]}),e.jsxs(Q,{variant:"destructive",children:[e.jsx(X,{children:"Warning!"}),e.jsx(Y,{children:"Please be carefull, this operation can not be rolled back."})]})]}),confirmText:"Delete",destructive:!0})}const oe=S({email:z({error:s=>s.input===""?"Please enter an email to invite.":void 0}),desc:m().optional()});function ne({open:s,onOpenChange:i}){const r=I({resolver:P(oe),defaultValues:{email:"",desc:""}}),o=t=>{r.reset(),V(t),i(!1)};return e.jsx(T,{open:s,onOpenChange:t=>{r.reset(),i(t)},children:e.jsxs(U,{className:"sm:max-w-md",children:[e.jsxs(A,{className:"text-left",children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(R,{})," Invite User"]}),e.jsx(O,{children:"Invite new user to join your team by sending them an email invitation. Assign a role to define their access level."})]}),e.jsx(F,{...r,children:e.jsxs("form",{id:"user-invite-form",onSubmit:r.handleSubmit(o),className:"space-y-4",children:[e.jsx(u,{control:r.control,name:"email",render:({field:t})=>e.jsxs(h,{children:[e.jsx(p,{children:"Email"}),e.jsx(x,{children:e.jsx(N,{type:"email",placeholder:"eg: john.doe@gmail.com",...t})}),e.jsx(j,{})]})}),e.jsx(u,{control:r.control,name:"desc",render:({field:t})=>e.jsxs(h,{className:"",children:[e.jsx(p,{children:"Description (optional)"}),e.jsx(x,{children:e.jsx(ee,{className:"resize-none",placeholder:"Add a personal note to your invitation (optional)",...t})}),e.jsx(j,{})]})})]})}),e.jsxs(_,{className:"gap-y-2",children:[e.jsx(G,{asChild:!0,children:e.jsx(y,{variant:"outline",children:"Cancel"})}),e.jsxs(y,{type:"submit",form:"user-invite-form",children:["Invite ",e.jsx(se,{})]})]})]})})}function ge(){const{open:s,setOpen:i,currentRow:r,setCurrentRow:o}=re();return e.jsxs(e.Fragment,{children:[e.jsx(D,{open:s==="add",onOpenChange:()=>i("add")},"user-add"),e.jsx(ne,{open:s==="invite",onOpenChange:()=>i("invite")},"user-invite"),r&&e.jsxs(e.Fragment,{children:[e.jsx(D,{open:s==="edit",onOpenChange:()=>{i("edit"),setTimeout(()=>{o(null)},500)},currentRow:r},`user-edit-${r.id}`),e.jsx(te,{open:s==="delete",onOpenChange:()=>{i("delete"),setTimeout(()=>{o(null)},500)},currentRow:r},`user-delete-${r.id}`)]})]})}export{Ne as U,ge as a,re as u};
